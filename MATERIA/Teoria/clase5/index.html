<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Clase 5 Proyecto 2014</title><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><meta name="author" content="Einar Lanfranco, Claudia Banchoff"></meta><meta name="description" content="Acceso a BBDD usando PHP + Modelo MVC"></meta><meta name="keywords" content="base de datos + MVC"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="proyecto.css" media="screen,projection"></link></head><body class="impress-not-supported"><div id="impress"><div class="step" step="0" data-x="0" data-y="0"><h1 id="proyecto-de-software">Proyecto de Software</h1><h1 id="cursada-2014">Cursada 2014</h1></div><div class="step" step="1" data-x="1600" data-y="0"><h1 id="hoy-seguimos-con">Hoy seguimos con ...</h1><img src="images/contenidos5.png" alt="" width="" height=""></img></div><div class="step" step="2" data-x="3200" data-y="0"><h1 id="temario">Temario</h1><ul><li><dl><dt>Repaso Clase Anterior</dt><dd><ul><li>Objetos</li><li>BBDD</li></ul></dd></dl></li><li><dl><dt>PHP</dt><dd><ul><li>BBDD problemas</li><li>MVC</li><li>Templates con Twig</li></ul></dd></dl></li></ul></div><div class="step" step="3" data-x="4800" data-y="0"><h1 id="repaso-poo-en-php">Repaso - POO en PHP</h1><ul><li>PHP tiene soporte para construir clases.</li><li>Es posible definir clases en una jerarqu&#xED;a con herencia simple.</li><li>El constructor es class</li></ul><img src="images/herencia-php-dibujo.png" alt="" width="500px" height=""></img></div><div class="step" step="4" data-x="6400" data-y="0"><h1 id="repaso-clases">Repaso Clases</h1><ul><li>Clase Archivo:</li></ul><pre class="highlight code php"><span class="x">class Archivo{
// variables de instancia
// m&#xE9;todos
}</span></pre><ul><li>Clase Archivo gr&#xE1;fico que hereda de Archivo:</li></ul><pre class="highlight code php"><span class="x">class ArchivoGrafico extends Archivo{
}</span></pre></div><div class="step" step="5" data-x="8000" data-y="0"><h1 id="consultas-usando-mysqli">Consultas usando mysqli</h1><pre class="highlight code php"><span class="cp">&lt;?php</span>
<span class="nv">$db_host</span><span class="o">=</span><span class="s2">"127.0.0.1"</span><span class="p">;</span>
<span class="nv">$db_user</span><span class="o">=</span><span class="s2">"user"</span><span class="p">;</span>
<span class="nv">$db_pass</span><span class="o">=</span><span class="s2">"pass"</span><span class="p">;</span>
<span class="nv">$db_base</span><span class="o">=</span><span class="s2">"base"</span><span class="p">;</span>
<span class="nv">$link</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mysqli</span><span class="p">(</span><span class="nv">$db_host</span><span class="p">,</span><span class="nv">$db_user</span><span class="p">,</span><span class="nv">$db_pass</span><span class="p">,</span><span class="nv">$db_base</span><span class="p">);</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM usuarios&#x201D;;
</span><span class="si">$result</span><span class="s2"> = </span><span class="si">$link-&gt;query</span><span class="s2">(</span><span class="si">$query</span><span class="s2">)
?&gt;</span></pre></div><div class="step" step="6" data-x="9600" data-y="0"><h1 id="usando-pdo">Usando PDO</h1><pre class="highlight code php"><span class="cp">&lt;?php</span>
   <span class="nv">$db_host</span><span class="o">=</span><span class="s2">"127.0.0.1"</span><span class="p">;</span>
   <span class="nv">$db_user</span><span class="o">=</span><span class="s2">"user"</span><span class="p">;</span>
   <span class="nv">$db_pass</span><span class="o">=</span><span class="s2">"pass"</span><span class="p">;</span>
   <span class="nv">$db_base</span><span class="o">=</span><span class="s2">"base"</span><span class="p">;</span>
   <span class="nv">$cn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s2">"mysql:dbname=</span><span class="si">$db_base</span><span class="s2">;host=</span><span class="si">$db_host</span><span class="s2">"</span><span class="p">,</span><span class="nv">$db_user</span><span class="p">,</span><span class="nv">$db_pass</span><span class="p">);</span>

  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM usuarios&#x201D;;


   </span><span class="si">$result</span><span class="s2">=</span><span class="si">$cn-&gt;query</span><span class="s2">(</span><span class="si">$query</span><span class="s2">);
?&gt;</span></pre></div><div class="step" step="7" data-x="11200" data-y="0"><h1 id="pero-y-si-quiero-interactuar-con-un-formulario-web">Pero y &#xBF;si quiero interactuar con un formulario web?</h1><h2 id="get-post-cookie-y-request">$_GET, $_POST, $_COOKIE y $_REQUEST</h2><ul><li>Ver: <a href="http://php.net/manual/es/reserved.variables.request.php">http://php.net/manual/es/reserved.variables.request.php</a></li><li>Ver: <a href="ejemplosClase5/1-MVC/0-pdo.php?usuario=2">Ejemplo-variables</a></li></ul></div><div class="step" step="8" data-x="12800" data-y="0"><h1 id="id1">Consultas usando mysqli</h1><pre class="highlight code php"><span class="cp">&lt;?php</span>

<span class="nv">$db_host</span><span class="o">=</span><span class="s2">"127.0.0.1"</span><span class="p">;</span>
<span class="nv">$db_user</span><span class="o">=</span><span class="s2">"user"</span><span class="p">;</span>
<span class="nv">$db_pass</span><span class="o">=</span><span class="s2">"pass"</span><span class="p">;</span>
<span class="nv">$db_base</span><span class="o">=</span><span class="s2">"base"</span><span class="p">;</span>
<span class="nv">$link</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mysqli</span><span class="p">(</span><span class="nv">$db_host</span><span class="p">,</span><span class="nv">$db_user</span><span class="p">,</span><span class="nv">$db_pass</span><span class="p">,</span><span class="nv">$db_base</span><span class="p">);</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM usuarios where nombre='"</span><span class="o">.</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"email"</span><span class="p">]</span><span class="o">.</span><span class="s2">"'
                                    and pass='"</span><span class="o">.</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"pass"</span><span class="p">]</span><span class="o">.</span><span class="s2">"';"</span><span class="p">;</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$link</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>

<span class="cp">?&gt;</span></pre></div><div class="step" step="9" data-x="14400" data-y="0"><h1 id="id2">Usando PDO</h1><pre class="highlight code php"><span class="cp">&lt;?php</span>
   <span class="nv">$db_host</span><span class="o">=</span><span class="s2">"127.0.0.1"</span><span class="p">;</span>
   <span class="nv">$db_user</span><span class="o">=</span><span class="s2">"user"</span><span class="p">;</span>
   <span class="nv">$db_pass</span><span class="o">=</span><span class="s2">"pass"</span><span class="p">;</span>
   <span class="nv">$db_base</span><span class="o">=</span><span class="s2">"base"</span><span class="p">;</span>
   <span class="nv">$cn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s2">"mysql:dbname=</span><span class="si">$db_base</span><span class="s2">;host=</span><span class="si">$db_host</span><span class="s2">"</span><span class="p">,</span><span class="nv">$db_user</span><span class="p">,</span><span class="nv">$db_pass</span><span class="p">);</span>

   <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM usuarios where nombre='"</span><span class="o">.</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"email"</span><span class="p">]</span><span class="o">.</span><span class="s2">"'
                                       and pass='"</span><span class="o">.</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"pass"</span><span class="p">]</span><span class="o">.</span><span class="s2">"';"</span><span class="p">;</span>

   <span class="nv">$result</span><span class="o">=</span><span class="nv">$cn</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
<span class="cp">?&gt;</span></pre></div><div class="step" step="10" data-x="16000" data-y="0"><h1 id="diferencias-desde-el-html">Diferencias desde el HTML</h1><p>Ver: <a href="ejemplosClase5/1-MVC/1-login.html">login-mysqli-html</a>  y <a href="ejemplosClase5/1-MVC/2-login.html">login-pdo-html</a></p><h1 id="diferencias-desde-el-php">Diferencias desde el PHP</h1><p>Ver fuente de: <a href="ejemplosClase5/1-MVC/1-login-mysqli.php">login-mysqli-php</a>   y <a href="ejemplosClase5/1-MVC/2-login-pdo.php">login-pdo-php</a></p></div><div class="step" step="11" data-x="17600" data-y="0"><h1 id="inyeccion">Inyecci&#xF3;n</h1><ul><li>Una SQL Injection suele ocurrir cuando se arma en forma descuidada una consulta a la base de datos a partir de los datos ingresados por el usuario.</li><li>Dentro de estos par&#xE1;metros pueden venir el c&#xF3;digo malicioso.</li></ul></div><div class="step" step="12" data-x="19200" data-y="0"><h1 id="sql-inyeccion">SQL Inyecci&#xF3;n</h1><h2 id="obtener-acceso-a-una-aplicacion">Obtener acceso a una aplicaci&#xF3;n:</h2><ul><li>Suponiendo que la consulta de autenticaci&#xF3;n de una pagina que pide id y pass es:</li></ul><pre class="highlight code sql"><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="s1">'&#x201D;. **$id** .&#x201D;'</span>
               <span class="k">and</span> <span class="n">pass</span><span class="o">=</span><span class="s1">'&#x201D;. **$pass** .&#x201D; '</span> <span class="p">;</span></pre><ul><li>Suponiendo <strong>$id='admin'</strong> y <strong>$pass='admin'</strong> el sql quedar&#xED;a:</li></ul><pre class="highlight code sql"><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="o">**</span><span class="n">id</span><span class="o">=</span><span class="s1">'admin'</span><span class="o">**</span> <span class="k">and</span> <span class="o">**</span><span class="n">pass</span><span class="o">=</span><span class="s1">'admin'</span><span class="o">**</span><span class="p">;</span></pre></div><div class="step" step="13" data-x="20800" data-y="0"><h1 id="id3">SQL Inyecci&#xF3;n</h1><ul><li>&#xBF;Qu&#xE9; sucede si usamos <strong>$id=$pass= 1' or '1=1</strong>?</li></ul><pre class="highlight code sql"><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="s1">'&#x201D;. **&#x201C;1'</span> <span class="k">or</span> <span class="s1">'1=1&#x201D;** .&#x201D;'</span> <span class="k">and</span>
                           <span class="n">pass</span><span class="o">=</span><span class="s1">'&#x201D;. **&#x201C;1'</span> <span class="k">or</span> <span class="s1">'1=1&#x201D;** .&#x201D;'</span><span class="err">&#x201D;</span><span class="p">;</span></pre><ul><li>Lo que se se resuelve en:</li></ul><pre class="highlight code sql"><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="o">**</span><span class="n">id</span><span class="o">=</span><span class="s1">'1'</span> <span class="k">or</span> <span class="s1">'1=1'</span><span class="o">**</span>
                    <span class="k">and</span> <span class="o">**</span><span class="n">pass</span><span class="o">=</span><span class="s1">'1'</span> <span class="k">or</span> <span class="s1">'1=1'</span><span class="o">**</span> <span class="p">;</span></pre><ul><li><strong>(Cualquier cosa OR True)</strong> es siempre <strong>TRUE</strong></li></ul></div><div class="step" step="14" data-x="22400" data-y="0"><h1 id="id4">SQL Inyecci&#xF3;n</h1><p>Para obtener acceso a una aplicaci&#xF3;n WEB, dependiendo del motor de base de datos, otras estructuras que se pueden usar son:</p><ul><li>' or 1=1--</li><li>" or 1=1--</li><li>or 1=1--</li><li>' or 'a'='a</li><li>" or "a"="a</li><li>') or ('a'='a</li></ul></div><div class="step" step="15" data-x="24000" data-y="0"><h1 id="id5">SQL Inyecci&#xF3;n</h1><p>Para razonar..... &#xBF;Qu&#xE9; pasa si en vez de pepe envio <strong>' or 1=1</strong> como par&#xE1;metro?</p><p>Ver: <a href="ejemplosClase5/1-MVC/1-login.html">login-mysqli-html</a>  y <a href="ejemplosClase5/1-MVC/2-login.html">login-pdo-html</a></p></div><div class="step" step="16" data-x="25600" data-y="0"><h1 id="id6">SQL Inyecci&#xF3;n</h1><ul><li>Para razonar..... &#xBF;Qu&#xE9; pasa si en vez de <strong>' or 1=1</strong> como par&#xE1;metro me las rebusco un poco m&#xE1;s?</li><li>Intentemos... SELECT * FROM usuarios where nombre=''or'1=1' and pass='';update usuarios set dni='234' where '1=1';</li><li>Ver: <a href="ejemplosClase5/1-MVC/1-login.html">login-mysqli-html</a>  (no deber&#xED;a funcionar)</li><li>Ver: <a href="ejemplosClase5/1-MVC/2-login.html">login-pdo-html</a> (s&#xED; deber&#xED;a funcionar)</li></ul></div><div class="step" step="17" data-x="27200" data-y="0"><h1 id="prepared-statement">Prepared Statement</h1><ul><li>Pueden definirse como un tipo de plantillas compiladas para SQL que las aplicaciones quieren ejecutar, pueden ser personalizadas usando par&#xE1;metros de variables.</li><li><dl><dt>Ventajas:</dt><dd><ul><li><strong>PERFORMANCE</strong>: La consulta s&#xF3;lo necesita ser analizada (o preparada) una vez, pero puede ser ejecutada m&#xFA;ltiples veces con los mismos o diferentes par&#xE1;metros. Us&#xE1;ndolas una sentencia preparada, la aplicaci&#xF3;n evita repetir el ciclo de an&#xE1;lisis/ compilaci&#xF3;n/ optimizaci&#xF3;n. Esto significa que las sentencias preparadas usan menos recursos y se ejecutan m&#xE1;s r&#xE1;pidamente.</li><li><strong>SEGURIDAD</strong>: Los par&#xE1;metros para las sentencias preparadas no necesitan estar entrecomillados; el controlador autom&#xE1;ticamente se encarga de esto. Si una aplicaci&#xF3;n usa exclusivamente sentencias preparadas, el desarrollador puede estar seguro de que no ocurrir&#xE1;n inyecciones SQL.</li></ul></dd></dl></li></ul></div><div class="step" step="18" data-x="28800" data-y="0"><h1 id="evitando-sqli-usando-mysqli">Evitando SQLi usando mysqli</h1><pre class="highlight code php"><span class="cp">&lt;?php</span>
<span class="nv">$db_host</span><span class="o">=</span><span class="s2">"127.0.0.1"</span><span class="p">;</span>
<span class="nv">$db_user</span><span class="o">=</span><span class="s2">"user"</span><span class="p">;</span>
<span class="nv">$db_pass</span><span class="o">=</span><span class="s2">"pass"</span><span class="p">;</span>
<span class="nv">$db_base</span><span class="o">=</span><span class="s2">"base"</span><span class="p">;</span>
<span class="nv">$link</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mysqli</span><span class="p">(</span><span class="nv">$db_host</span><span class="p">,</span><span class="nv">$db_user</span><span class="p">,</span><span class="nv">$db_pass</span><span class="p">,</span><span class="nv">$db_base</span><span class="p">);</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM usuarios where nombre=? and pass=?"</span><span class="p">;</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$link</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>

<span class="nv">$result</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"ss"</span><span class="p">,</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"email"</span><span class="p">],</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"pass"</span><span class="p">]);</span>

<span class="nv">$result</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
<span class="cp">?&gt;</span></pre></div><div class="step" step="19" data-x="30400" data-y="0"><h1 id="ver-demo">Ver DEMO</h1><ul><li>Ver: <a href="ejemplosClase5/1-MVC/3-login.html">login-mysqli-ps-html</a> y fuente de <a href="ejemplosClase5/1-MVC/3-login-mysqli-ps.php">login-mysqli-ps-php</a></li></ul></div><div class="step" step="20" data-x="32000" data-y="0"><h1 id="evitando-sqli-usando-pdo">Evitando SQLi usando PDO</h1><pre class="highlight code php"><span class="cp">&lt;?php</span>
   <span class="nv">$db_host</span><span class="o">=</span><span class="s2">"127.0.0.1"</span><span class="p">;</span>
   <span class="nv">$db_user</span><span class="o">=</span><span class="s2">"user"</span><span class="p">;</span>
   <span class="nv">$db_pass</span><span class="o">=</span><span class="s2">"pass"</span><span class="p">;</span>
   <span class="nv">$db_base</span><span class="o">=</span><span class="s2">"base"</span><span class="p">;</span>

   <span class="nv">$cn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s2">"mysql:dbname=</span><span class="si">$db_base</span><span class="s2">;host=</span><span class="si">$db_host</span><span class="s2">"</span><span class="p">,</span><span class="nv">$db_user</span><span class="p">,</span><span class="nv">$db_pass</span><span class="p">);</span>

   <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$cn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">"SELECT * FROM usuarios where nombre=? and pass=?"</span><span class="p">);</span>
   <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"email"</span><span class="p">],</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"pass"</span><span class="p">]));</span>
<span class="cp">?&gt;</span></pre></div><div class="step" step="21" data-x="33600" data-y="0"><h1 id="id7">Ver DEMO</h1><blockquote><ul><li>Ver: <a href="ejemplosClase5/1-MVC/4-login.html">login-pdo-ps-html</a> y fuente de <a href="ejemplosClase5/1-MVC/4-login-pdo-ps.php">login-pdo-ps-php</a></li></ul></blockquote></div><div class="step" step="22" data-x="35200" data-y="0"><h1 id="insertar-datos-con-pdo">Insertar datos con PDO</h1><pre class="highlight code php"><span class="cp">&lt;?php</span>
<span class="nv">$sentencia</span>&#xA0;<span class="o">=</span>&#xA0;<span class="nv">$gbd</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">"INSERT&#xA0;INTO&#xA0;REGISTRY&#xA0;(name,&#xA0;value)
                                     VALUES&#xA0;(:name,&#xA0;:value)"</span><span class="p">);</span>
<span class="nv">$sentencia</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s1">':name'</span><span class="p">,</span>&#xA0;<span class="nv">$nombre</span><span class="p">);</span>
<span class="nv">$sentencia</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s1">':value'</span><span class="p">,</span>&#xA0;<span class="nv">$valor</span><span class="p">);</span>
<span class="c1">//&#xA0;insertar&#xA0;una&#xA0;fila
</span><span class="nv">$nombre</span>&#xA0;<span class="o">=</span>&#xA0;<span class="s1">'uno'</span><span class="p">;</span>
<span class="nv">$value</span>&#xA0;<span class="o">=</span>&#xA0;<span class="mi">1</span><span class="p">;</span>
<span class="nv">$sentencia</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
<span class="c1">//&#xA0;insertar&#xA0;otra&#xA0;fila&#xA0;con&#xA0;diferentes&#xA0;valores
</span><span class="nv">$nombre</span>&#xA0;<span class="o">=</span>&#xA0;<span class="s1">'dos'</span><span class="p">;</span>
<span class="nv">$valor</span>&#xA0;<span class="o">=</span>&#xA0;<span class="mi">2</span><span class="p">;</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
<span class="cp">?&gt;</span></pre></div><div class="step" step="23" data-x="36800" data-y="0"><h1 id="model-cliente-servidor">Model cliente servidor</h1><img src="images/cliente-servidor.jpg" alt="" width="800px" height=""></img><ul><li>Ver <a href="ejemplosClase5/1-MVC/5-sinMVC.php">cliente_servidor_sin_MVC</a></li></ul></div><div class="step" step="24" data-x="38400" data-y="0"><h1 id="patron-mvc">Patr&#xF3;n MVC</h1><h1 id="model-view-controller">Model &#x2013; View - Controller</h1></div><div class="step" step="25" data-x="40000" data-y="0"><h1 id="id8">Model &#x2013; View - Controller</h1><ul><li><dl><dt>Tres componentes:</dt><dd><ul><li>Modelo</li><li>Vista</li><li>Control</li></ul></dd></dl></li><li>El principio m&#xE1;s importante de la arquitectura MVC es la separaci&#xF3;n del c&#xF3;digo del programa en tres capas, dependiendo de su naturaleza.</li><li>La l&#xF3;gica relacionada con los datos se incluye en el modelo, el c&#xF3;digo de la presentaci&#xF3;n en la vista y la l&#xF3;gica de la aplicaci&#xF3;n en el controlador.</li></ul></div><div class="step" step="26" data-x="41600" data-y="0"><h1 id="mvc">MVC</h1><img src="images/mvc1.png" alt="" width="450px" height=""></img><ul><li>Reduce la complejidad, facilita la reutilizaci&#xF3;n y acelera el proceso de comunicaci&#xF3;n entre capas.</li></ul></div><div class="step" step="27" data-x="43200" data-y="0"><h1 id="aplicacion-tipica-sin-mvc">Aplicaci&#xF3;n T&#xED;pica SIN MVC</h1><ul><li>Aplicaci&#xF3;n t&#xED;pica que no sigue MVC tiene todo el c&#xF3;digo en el mismo lugar.</li><li>Ver Ejemplo <a href="ejemplosClase5/1-MVC/5-sinMVC.php">cliente_servidor_sin_MVC</a></li></ul></div><div class="step" step="28" data-x="44800" data-y="0"><h1 id="mvc-separando-la-vista">MVC &#x2013; Separando la Vista</h1><img src="images/mvc-parcial-modelo.png" alt="" width="" height=""></img><img src="images/mvc-parcial-vista.png" alt="" width="" height=""></img></div><div class="step" step="29" data-x="46400" data-y="0"><h1 id="id9">MVC &#x2013; Separando la Vista</h1><ul><li>Ver: codigos fuente de <a href="ejemplosClase5/1-MVC/6-vista.php">La-vista</a> y <a href="ejemplosClase5/1-MVC/6-separoVIsta.php">Separando-la-vista</a></li></ul></div><div class="step" step="30" data-x="48000" data-y="0"><h1 id="mvc-separando-el-modelo">MVC &#x2013; Separando el modelo</h1><img src="images/mvc-controller.png" alt="" width="" height=""></img><img src="images/mvc-modelo.png" alt="" width="" height=""></img></div><div class="step" step="31" data-x="49600" data-y="0"><h1 id="id10">MVC &#x2013; Separando el modelo</h1><ul><li>Ver: codigos fuente de <a href="ejemplosClase5/1-MVC/7-modelo.php">El-modelo</a> y <a href="ejemplosClase5/1-MVC/8-implementandoMVC.php">MVC-completo</a></li></ul></div><div class="step" step="32" data-x="51200" data-y="0"><h1 id="variaciones-del-mvc-original">Variaciones del MVC original</h1><ul><li>MVC en symfony</li><li>Model View Presenter</li><li>Model View Adapter</li></ul></div><div class="step" step="33" data-x="52800" data-y="0"><h1 id="mvc-el-caso-de-symfony-1-4">MVC &#x2013;El caso de Symfony 1.4</h1><img src="images/mvc-symfony-1.4.png" alt="" width="450px" height=""></img></div><div class="step" step="34" data-x="54400" data-y="0"><h1 id="id11">MVC &#x2013;El caso de Symfony 1.4</h1><img src="images/mvc-symfony-1.4.2.png" alt="" width="350px" height=""></img></div><div class="step" step="35" data-x="56000" data-y="0"><h1 id="model-view-presenter">Model View Presenter</h1><img src="images/model-view-presenter.png" alt="" width="800px" height=""></img></div><div class="step" step="36" data-x="57600" data-y="0"><h1 id="id12">Model View Presenter</h1><img src="images/model-view-presenter.2.png" alt="" width="900px" height=""></img></div><div class="step" step="37" data-x="59200" data-y="0"><h1 id="model-view-adapter">Model View Adapter</h1><img src="images/mva.png" alt="" width="900px" height=""></img></div><div class="step" step="38" data-x="60800" data-y="0"><h1 id="referencias">Referencias</h1><ul><li>PHP -&gt; <a href="http://php.net">http://php.net</a></li><li>PhpMyAdmin -&gt; <a href="http://www.phpmyadmin.net">http://www.phpmyadmin.net</a></li><li>Lenguaje SQL -&gt; <a href="http://www.w3schools.com/sql/default.asp">http://www.w3schools.com/sql/default.asp</a></li><li>PDO -&gt;  <a href="http://www.php.net/manual/es/class.pdostatement.php">http://www.php.net/manual/es/class.pdostatement.php</a></li><li>Mysqli -&gt; <a href="http://php.net/manual/es/mysqli.prepare.php">http://php.net/manual/es/mysqli.prepare.php</a></li><li>MySQL -&gt; <a href="http://dev.mysql.com/doc/">http://dev.mysql.com/doc/</a></li><li>MVC -&gt; <a href="http://es.wikipedia.org/wiki/Modelo_Vista_Controlador#Frameworks_MVC">http://es.wikipedia.org/wiki/Modelo_Vista_Controlador#Frameworks_MVC</a></li><li>Symfony y el MVC -&gt; <a href="http://librosweb.es/symfony_1_4/capitulo_2/el_patron_mvc.html">http://librosweb.es/symfony_1_4/capitulo_2/el_patron_mvc.html</a></li><li>Prepared Statement -&gt; <a href="http://en.wikipedia.org/wiki/Prepared_statement">http://en.wikipedia.org/wiki/Prepared_statement</a></li></ul></div><div class="step" step="39" data-x="62400" data-y="0"><h1 id="la-vista">La Vista</h1><h1 id="programando-con-templates-alternativas-para-el-view">Programando con Templates &#x2013; Alternativas para el View</h1></div><div class="step" step="40" data-x="64000" data-y="0"><h1 id="templates-en-php">Templates en PHP</h1><ul><li>El uso de templates o plantillas permite separar la aplicaci&#xF3;n de la presentaci&#xF3;n, pero ....</li></ul><h1 id="no-asegura-mvc-esa-es-nuestra-responsabilidad">No asegura MVC. Esa es NUESTRA responsabilidad</h1><ul><li><dl><dt>Algunas opciones:</dt><dd><ul><li>Smarty, <a href="http://smarty.php.net">http://smarty.php.net</a></li><li>PEAR::HTML_Templates_IT, http://pear.php.net</li><li>Dwoo, <a href="http://dwoo.org/">http://dwoo.org/</a></li><li>Twig, <a href="http://twig.sensiolabs.org/">http://twig.sensiolabs.org/</a></li><li>Savant, <a href="http://www.phpsavant.com/">http://www.phpsavant.com/</a></li><li>Blade, <a href="http://laravel.com/docs/templates">http://laravel.com/docs/templates</a></li></ul></dd></dl></li></ul></div><div class="step" step="41" data-x="65600" data-y="0"><h1 id="twig">Twig</h1><ul><li>Twig es un motor de templates en PHP promocionado como un motor de plantilla flexible, r&#xE1;pido, y seguro.</li><li>Desarrollado y distribuido bajo licencia BSD. Documentaci&#xF3;n bajo licencia Creative Commons.</li><li><dl><dt>&#xBF;Por qu&#xE9; lo elegimos en la c&#xE1;tedra?</dt><dd><ul><li>Porque es la alternativa que apoya Fabien Potencier, el creador del framework Symfony. Y es la opci&#xF3;n por defecto en Symfony 2.</li><li>Muchos Frameworks como Laravel o Yii lo pueden utilizar</li><li>Cuestiones de seguridad embebidas</li><li>Es muy similar a otros motores con lo cual el traspaso es inmediato</li></ul></dd></dl></li></ul></div><div class="step" step="42" data-x="67200" data-y="0"><h1 id="dependency-manager-for-php">Dependency Manager for PHP</h1><img src="images/logo-composer-transparent.png" alt="" width="" height=""></img><ul><li><a href="https://getcomposer.org/">https://getcomposer.org/</a></li><li><a href="https://packagist.org">https://packagist.org</a></li></ul></div><div class="step" step="43" data-x="68800" data-y="0"><h1 id="id13">Twig</h1><ul><li>Primeros pasos: Hay que instalarlo!</li></ul><p><a href="http://twig.sensiolabs.org/doc/installation.html">http://twig.sensiolabs.org/doc/installation.html</a></p></div><div class="step" step="44" data-x="70400" data-y="0"><h1 id="instalando-twig">Instalando Twig</h1><img src="images/twig-via-composer.png" alt="" width="800px" height=""></img></div><div class="step" step="45" data-x="72000" data-y="0"><h1 id="id14">Templates en PHP</h1><ul><li>Las librer&#xED;as que permiten trabajar con templates definen una serie de clases a importar en nuestros scripts PHP.</li></ul><pre class="highlight code php"><span class="cp">&lt;?php</span>
        <span class="k">require_once</span><span class="p">(</span><span class="s2">"Twig/Autoloader.php"</span><span class="p">);</span>
        <span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Loader_Filesystem</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span>
        <span class="nv">$twig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Environment</span><span class="p">(</span><span class="nv">$loader</span><span class="p">);</span>
        <span class="nv">$template</span> <span class="o">=</span> <span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">loadTemplate</span><span class="p">(</span><span class="s2">"prueba.tpl"</span><span class="p">);</span>
        <span class="err">&#x2026;</span><span class="o">..</span> <span class="nx">completar</span> <span class="nx">lo</span> <span class="nx">que</span> <span class="nx">se</span> <span class="nx">deba</span> <span class="nx">completar</span> <span class="o">...</span>
        <span class="nv">$template</span><span class="o">-&gt;</span><span class="na">display</span><span class="p">();</span>
<span class="cp">?&gt;</span></pre><ul><li>Luego hay que definir el archivo <strong>.tpl</strong> que tiene una sintaxis particular.</li></ul></div><div class="step" step="46" data-x="73600" data-y="0"><h1 id="templates-con-twig">Templates con Twig</h1><ul><li>Antes que nada, debemos cargar la librer&#xED;a. &#xBF;Qu&#xE9; es la &#x201C;autocarga&#x201D; de clases?</li></ul><pre class="highlight code php"><span class="cp">&lt;?php</span>
<span class="o">.....</span> <span class="nx">Twig</span><span class="o">......</span>
<span class="k">require_once</span><span class="p">(</span><span class="s2">"Twig/Autoloader.php"</span><span class="p">);</span>
<span class="cp">?&gt;</span></pre></div><div class="step" step="47" data-x="75200" data-y="0"><h1 id="id15">Templates con Twig</h1><ul><li>Twig utiliza un objeto (instancia de la clase Twig_Environment) utilizado para almacenar distintas  opciones de configuraci&#xF3;n y utilizado para cargar los templates. En este caso, $dir contiene el nombre del directorio donde se encuentran los templates.</li></ul><pre class="highlight code php"><span class="cp">&lt;?php</span>
        <span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Loader_Filesystem</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span>
        <span class="nv">$twig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Environment</span><span class="p">(</span><span class="nv">$loader</span><span class="p">);</span>
        <span class="err">&#x2026;</span><span class="o">..</span> <span class="nx">completar</span> <span class="nx">lo</span> <span class="nx">que</span> <span class="nx">se</span> <span class="nx">deba</span> <span class="nx">completar</span> <span class="o">...</span>
<span class="cp">?&gt;</span></pre></div><div class="step" step="48" data-x="76800" data-y="0"><h1 id="id16">Templates con Twig</h1><ul><li>Por &#xFA;ltimo, cargamos el template y lo mostramos.</li></ul><pre class="highlight code php"><span class="cp">&lt;?php</span>
        <span class="o">.....</span> <span class="nx">Twig</span><span class="o">......</span>
        <span class="nv">$template</span> <span class="o">=</span> <span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">loadTemplate</span><span class="p">(</span><span class="s2">"prueba.tpl"</span><span class="p">);</span>
        <span class="err">&#x2026;</span><span class="o">..</span> <span class="nx">completar</span> <span class="nx">lo</span> <span class="nx">que</span> <span class="nx">se</span> <span class="nx">deba</span> <span class="nx">completar</span> <span class="o">...</span>
        <span class="nv">$template</span><span class="o">-&gt;</span><span class="na">display</span><span class="p">();</span>
<span class="cp">?&gt;</span></pre></div><div class="step" step="49" data-x="78400" data-y="0"><h1 id="los-templates-de-twig">Los Templates de Twig</h1><ul><li>Los templates se utilizan para definir la vista.</li><li>Tienen un formato especial.</li><li>No utiliza una extensi&#xF3;n en particular (podr&#xED;a ser html, xml, twig, tpl, etc.).</li><li>Son procesados por el sistema de plantillas.</li><li>Contienen variables o expresiones que son reemplazadas cuando se procesa el template y  tags que proveen la l&#xF3;gica de la presentaci&#xF3;n.</li></ul></div><div class="step" step="50" data-x="80000" data-y="0"><h1 id="formato">Formato</h1><ul><li>Todas las etiquetas del template se encierran  entre dos tipos de delimitadores</li></ul><pre class="highlight code php"><span class="x">{{  ... }}
{% ... %}</span></pre><ul><li>Todo el contenido fuera de los delimitadores se muestra como contenido est&#xE1;tico.</li></ul><blockquote><ul><li><dl><dt>Ver:</dt><dd><ul><li><a href="ejemplosClase5/2-TWIG/1-ejemploTwig.php">ejemplo1_twig_php</a></li><li><a href="ejemplosClase5/2-TWIG/templates/pruebas.twig.html">ejemplo1_twig_tmpl</a></li><li><a href="ejemplosClase5/2-TWIG/templates/plantilla-1.twig.html">ejemplo1_twig_tmpl2</a></li></ul></dd></dl></li></ul></blockquote></div><div class="step" step="51" data-x="81600" data-y="0"><h1 id="variables">Variables</h1><ul><li>Las variables pueden ser variables simples, arreglos u objetos definidos en la aplicaci&#xF3;n.</li></ul><pre class="highlight code html">{{ variable }}
{{variable.atributo}}
{{variable[2]}}
{{variable[&#x201C;atributo&#x201D;]}}</pre><ul><li>Tambi&#xE9;n es posible darle valores dentro del template:</li></ul><pre class="highlight code php"><span class="x">{% set var = 'algo' %}
{% set var = [1, 2] %}
{% set var = {'valor': 'algo'} %}</span></pre></div><div class="step" step="52" data-x="83200" data-y="0"><h1 id="id17">Variables</h1><ul><li><dl><dt>Ver:</dt><dd><ul><li><a href="ejemplosClase5/2-TWIG/2-ejemploTwig.php">ejemplo2_twig_php</a></li><li><a href="ejemplosClase5/2-TWIG/templates/plantilla-2.twig.html">ejemplo2_twig_tmpl</a></li></ul></dd></dl></li></ul></div><div class="step" step="53" data-x="84800" data-y="0"><h1 id="filtros">Filtros</h1><ul><li>Las variables pueden ser modificadas utilizando filtros.</li></ul><pre class="highlight code php"><span class="x">{{ '1234'|reverse }}</span></pre><ul><li><dl><dt>Ver</dt><dd><ul><li><a href="ejemplosClase5/2-TWIG/3-ejemploTwig.php">ejemplo3_twig_php</a></li><li><a href="ejemplosClase5/2-TWIG/templates/plantilla-3.twig.html">ejemplo3_twig_tmpl</a></li></ul></dd></dl></li><li>Algunos filtros: date, format, replace, url_encode, capitalize json_encode, upper, lower, join, sort, number_format, trim, etc.</li><li>Ver: <a href="http://twig.sensiolabs.org/doc/filters/index.html">http://twig.sensiolabs.org/doc/filters/index.html</a></li></ul></div><div class="step" step="54" data-x="86400" data-y="0"><h1 id="funciones">Funciones</h1><ul><li>Existen funciones predefinidas que pueden invocarse en los templates</li></ul><pre class="highlight code php"><span class="x">&lt;pre&gt;
        {{ dump() }}
&lt;/pre&gt;</span></pre><ul><li><dl><dt>Ver</dt><dd><ul><li><a href="ejemplosClase5/2-TWIG/4-ejemploTwig.php">ejemplo4_twig_php</a></li><li><a href="ejemplosClase5/2-TWIG/templates/plantilla-4.twig.html">ejemplo4_twig_tmpl</a></li></ul></dd></dl></li><li>Algunos funciones: range, cycle, attribute, date,  random, etc</li><li>Ver <a href="http://twig.sensiolabs.org/doc/functions/index.html">http://twig.sensiolabs.org/doc/functions/index.html</a></li></ul></div><div class="step" step="55" data-x="88000" data-y="0"><h1 id="estructuras-de-control">Estructuras de Control</h1><ul><li>Siempre aparecen  en bloques   {% ... %}</li><li>Es posible incluir bloques if/elseif/else y for</li><li><dl><dt>Ver</dt><dd><ul><li><a href="ejemplosClase5/2-TWIG/5-ejemploTwig.php">ejemplo5_twig_php</a></li><li><a href="ejemplosClase5/2-TWIG/templates/plantilla-5.twig.html">ejemplo5_twig_tmpl</a></li></ul></dd></dl></li><li>M&#xE1;s etiquetas en: <a href="http://twig.sensiolabs.org/doc/tags/index.html">http://twig.sensiolabs.org/doc/tags/index.html</a></li></ul></div><div class="step" step="56" data-x="89600" data-y="0"><h1 id="algunas-cosas-mas">Algunas cosas m&#xE1;s</h1><ul><li>Se pueden incluir comentarios:</li></ul><pre class="highlight code php"><span class="x">{# ... #}</span></pre><ul><li>Se pueden incluir otros templates</li></ul><pre class="highlight code php"><span class="x">{% include 'sidebar.html' %}</span></pre><ul><li>Twig define una mecanismo de herencia de templates.</li><li>Permite definir un template base que contiene los elementos comunes y luego definir los bloques que los &#x201C;templates hijos&#x201D; redefinir&#xE1;n.</li></ul></div><div class="step" step="57" data-x="91200" data-y="0"><h1 id="id18">Algunas cosas m&#xE1;s</h1><ul><li><dl><dt>Ver</dt><dd><ul><li><a href="ejemplosClase5/2-TWIG/6-ejemploTwig.php">ejemplo6_twig_php</a></li><li><a href="ejemplosClase5/2-TWIG/templates/plantilla-6.twig.html">ejemplo6_twig_tmpl</a></li><li><a href="ejemplosClase5/2-TWIG/6-ejemploTwigHIJO.php">ejemplo6_hijo_twig_php</a></li><li><a href="ejemplosClase5/2-TWIG/templates/plantilla-6-hijo.twig.hmtl">ejemplo6_hijo_twig_tmpl</a></li></ul></dd></dl></li></ul></div><div class="step" step="58" data-x="92800" data-y="0"><h1 id="un-poco-mas-sobre-el-ambiente">Un poco m&#xE1;s sobre el ambiente</h1><ul><li>Algunas opciones en el momento de crear el ambiente para cargar los templates:</li><li>cache: se evita volver a parsear los templates.</li></ul><pre class="highlight code php"><span class="cp">&lt;?php</span>
<span class="nv">$twig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twig_Environment</span><span class="p">(</span><span class="nv">$loader</span><span class="p">),</span>
                <span class="k">array</span><span class="p">(</span><span class="s2">"cache"</span> <span class="o">=&gt;</span> <span class="nv">$templateDirCompi</span><span class="p">,</span>
                  <span class="p">));</span>
<span class="cp">?&gt;</span></pre></div><div class="step" step="59" data-x="94400" data-y="0"><h1 id="si-algo-falla">Si algo falla...</h1><ul><li><dl><dt>Twig puede levantar las siguientes excepciones:</dt><dd><ul><li><strong>Twig_Error</strong>: La excepci&#xF3;n base para todos los errores.</li><li><strong>Twig_Error_Syntax</strong>: Cuando hay alg&#xFA;n problema con la sintaxis del template.</li><li><strong>Twig_Error_Runtime</strong>: Cuando hay un error en tiempo de ejecuci&#xF3;n (por ejemplo, cuando se utiliza un filtro que no existe para una instancia dada).</li><li><strong>Twig_Error_Loader</strong>: Se produce un error durante la carga del template</li></ul></dd></dl></li></ul></div><div class="step" step="60" data-x="96000" data-y="0"><h1 id="id19">Referencias</h1><ul><li>Twig <a href="http://twig.sensiolabs.org">http://twig.sensiolabs.org</a></li><li>The Twig Book <a href="http://twig.sensiolabs.org/pdf/Twig.pdf">http://twig.sensiolabs.org/pdf/Twig.pdf</a></li><li>Symfony <a href="http://symfony.com/doc/current/book/templating.html">http://symfony.com/doc/current/book/templating.html</a></li><li>Una intro en espa&#xF1;ol: <a href="http://gitnacho.github.com/symfony-docs-es/quick_tour/the_view.html">http://gitnacho.github.com/symfony-docs-es/quick_tour/the_view.html</a></li></ul></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Left, Down, Page Down</th><td>Next slide</td></tr><tr><th>Right, Up, Page Up</th><td>Previous slide</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>