<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Clase 4 Proyecto 2014</title><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><meta name="author" content="Einar Lanfranco, Claudia Banchoff"></meta><meta name="description" content="Acceso a BBDD usando PHP + Modelo MVC + Objetos en PHP"></meta><meta name="keywords" content="base de datos"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="proyecto.css" media="screen,projection"></link></head><body class="impress-not-supported"><div id="impress"><div class="step" step="0" data-x="0" data-y="0"><h1 id="proyecto-de-software">Proyecto de Software</h1><h1 id="cursada-2014">Cursada 2014</h1></div><div class="step" step="1" data-x="1600" data-y="0"><h1 id="hoy-seguimos-con">Hoy seguimos con ...</h1><img src="images/contenidos3.png" alt="" width="" height=""></img></div><div class="step" step="2" data-x="3200" data-y="0"><h1 id="temario">Temario</h1><ul><li>Repaso Clase Anterior</li><li><dl><dt>PHP</dt><dd><ul><li>BBDD</li><li>MVC</li><li>Objetos</li></ul></dd></dl></li></ul></div><div class="step" step="3" data-x="4800" data-y="0"><h1 id="cookies">Cookies</h1><ul><li>B&#xE1;sicamente, son &#x201C;tokens&#x201D; en el requerimiento HTTP que permite identificar de alguna manera al cliente en el servidor.</li><li>Se almacenan en el disco del cliente.</li><li>Muy usado por ser HTTP un protocolo sin estado</li><li>Formato: <strong>nombreCookie=valor;expires=fecha;</strong></li><li>PHP las considera variables externas: Usa $_COOKIE (un arreglo con las cookies generadas)</li><li>Mediante la funci&#xF3;n setcookie() es posible grabar cookies en el cliente.</li><li>Veamos un ejemplo de uso de <a href="http://localhost/2014/1%20-%20sesiones/set_cookies.php">cookies</a></li></ul></div><div class="step destacado" step="4" data-x="6400" data-y="0"><h1 id="sesiones">Sesiones</h1><p>Es un mecanismo para conservar ciertos datos a lo largo de varios accesos.</p><ul><li>Permite registrar un n&#xFA;mero arbitrario de variables que se conservar&#xE1;n en las siguientes peticiones.</li><li>Identificador: A cada visitante se le asigna un identificador &#xFA;nico, llamado <strong>session id</strong> (identificador de sesi&#xF3;n).</li><li><dl><dt>Hay dos formas de  propagar un identificador de sesi&#xF3;n:</dt><dd><ul><li>Mediante cookies</li><li>A trav&#xE9;s de la URL.</li></ul></dd></dl></li></ul></div><div class="step" step="5" data-x="8000" data-y="0"><h1 id="id2">Sesiones</h1><ul><li><dl><dt>Algunas funciones:</dt><dd><ul><li><strong>session_start()</strong>: Inicializa los datos de una sesi&#xF3;n.</li><li><strong>session_destroy()</strong>: Destruye los datos guardados en una sesi&#xF3;n.</li><li><strong>session_id()</strong>: recupera o modifica el valor de la sesi&#xF3;n.</li></ul></dd></dl></li><li><strong>Debe ubicarse antes que cualquier salida al browser</strong>.</li><li>Si no existe un <strong>session ID</strong>, session_start() lo crea e inicializa un arreglo vac&#xED;o denominado  $_SESSION.</li></ul></div><div class="step" step="6" data-x="9600" data-y="0"><h1 id="id3">Sesiones</h1><ul><li>Los archivos con los datos de la sesi&#xF3;n se generan en el servidor, usualmente en el directorio tmp del servidor.</li><li>El cliente s&#xF3;lo guarda el session Id</li></ul><p>Veamos el ejemplo de <a href="ejemplosClase4/sesiones1.php">sesiones</a></p></div><div class="step" step="7" data-x="11200" data-y="0"><h1 id="poo-en-php">POO en PHP</h1><ul><li>PHP tiene soporte para construir clases.</li><li>Es posible definir clases en una jerarqu&#xED;a con herencia simple.</li><li>El constructor es class</li></ul><img src="images/herencia-php-dibujo.png" alt="" width="500px" height=""></img></div><div class="step" step="8" data-x="12800" data-y="0"><h1 id="clases">Clases</h1><ul><li>Clase Archivo:</li></ul><pre class="highlight code php"><span class="x">class Archivo{
// variables de instancia
// m&#xE9;todos
}</span></pre><ul><li>Clase Archivo gr&#xE1;fico que hereda de Archivo:</li></ul><pre class="highlight code php"><span class="x">class ArchivoGrafico extends Archivo{
}</span></pre></div><div class="step" step="9" data-x="14400" data-y="0"><h1 id="instancias-de-una-clase">Instancias de una clase</h1><p>Operador new
<strong>$x = new nombreDeLaClase;</strong></p><pre class="highlight code php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">Persona</span> <span class="p">{</span>
       <span class="k">protected</span> <span class="nv">$nombre</span><span class="p">;</span>
       <span class="k">public</span> <span class="nv">$dni</span><span class="p">;</span>
       <span class="k">function</span> <span class="nf">verNombre</span><span class="p">(){</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nombre</span><span class="p">;}</span>
 <span class="p">}</span>
<span class="nv">$per1</span><span class="o">=</span><span class="k">new</span> <span class="nx">Persona</span><span class="p">;</span>
<span class="nv">$per2</span><span class="o">=</span><span class="k">new</span> <span class="nx">Persona</span><span class="p">;</span>
<span class="nv">$per1</span><span class="o">-&gt;</span><span class="na">verNombre</span><span class="p">();</span>
<span class="nv">$per2</span><span class="o">-&gt;</span><span class="na">dni</span><span class="o">=</span><span class="nv">$per1</span><span class="o">-&gt;</span><span class="na">dni</span><span class="p">;</span>
<span class="cp">?&gt;</span></pre></div><div class="step" step="10" data-x="16000" data-y="0"><h1 id="ejemplo-de-clase-en-php">Ejemplo de clase en PHP</h1><blockquote><p>Ver <a href="ejemplosClase4/0-ClasesEnPHP.php">clases</a></p></blockquote></div><div class="step" step="11" id="alcance" data-x="17600" data-y="0"><h1 id="visibilidad-de-las-propiedades">Visibilidad de las propiedades</h1><ul><li><strong>P&#xFA;blico</strong>: Los miembros de clases declarados como <strong>public</strong> pueden ser accedidos desde cualquier lado</li><li><strong>Privado</strong>: Aquellos miembros definidos como <strong>private</strong>, &#xFA;nicamentede pueden ser accedidos desde la clase que los defini&#xF3;.</li><li><strong>Protegido</strong>: Los miembros declarados como <strong>protected</strong>, s&#xF3;lo desde la misma clase, desde las clases que hereden de ella y desde las clases parent.</li></ul></div><div class="step" step="12" data-x="19200" data-y="0"><h1 id="ejemplo">Ejemplo:</h1><img src="images/variables-alcance-php.png" alt="" width="900px" height=""></img><ul><li><a href="http://php.net/manual/es/language.oop5.visibility.php">http://php.net/manual/es/language.oop5.visibility.php</a></li></ul></div><div class="step" step="13" data-x="20800" data-y="0"><h1 id="resolucion-de-alcance">(::) Resoluci&#xF3;n de Alcance</h1><blockquote><p>Este operador permite referenciar a las propiedades o m&#xE9;todos est&#xE1;ticos y constantes fuera de la la clase.</p></blockquote><img src="images/constante.png" alt="" width="700px" height=""></img><img src="images/metodoconstante.png" alt="" width="700px" height=""></img></div><div class="step" step="14" data-x="22400" data-y="0"><h1 id="varios">Varios</h1><ul><li>Operador <strong>instanceof</strong></li></ul><pre class="highlight code php"><span class="x">  </span><span class="cp">&lt;?php</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nv">$emple</span> <span class="nx">instanceof</span> <span class="nx">Empleado</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"Esto es un empleado"</span><span class="p">;</span>
<span class="p">}</span>
  <span class="cp">?&gt;</span></pre><ul><li>Enlaces est&#xE1;ticos <strong>parent, self y static</strong>. Ver <a href="ejemplosClase4/1-static_self_parent.php">Ejemplo</a></li><li><strong>Constructores</strong>: En PHP 5 estas funciones se llaman __construct(). Aunque por compatibilidad con versiones anteriores, si no se encuentra esta funci&#xF3;n se busca una cuyo nombre sea igual al de la clase.</li></ul></div><div class="step" step="15" data-x="24000" data-y="0"><h1 id="constructores">Constructores</h1><img src="images/constructores-php.png" alt="" width="800px" height=""></img></div><div class="step" step="16" data-x="25600" data-y="0"><h1 id="destructores">Destructores:</h1><ul><li>Cuando se destruye la &#xFA;ltima referencia a un objeto, se invoca el m&#xE9;todo &#x201C;destructor&#x201D; de ese objeto.</li><li>Este m&#xE9;todo se llama <strong>__destruct()</strong> y no recibe par&#xE1;metros.</li><li>Al igual que en el caso de los constructores, los m&#xE9;todos destructores de un objeto NO invocan autom&#xE1;ticamente los destructores de las clase base.  Deben invocarse expl&#xED;citamente:  <strong>parent::__destruct()</strong> en el cuerpo del m&#xE9;todo.</li></ul></div><div class="step" step="17" data-x="27200" data-y="0"><h1 id="miembros-static">Miembros static</h1><ul><li>Una propiedad declarada como static no puede ser accedida con un objeto de la clase. S&#xED; a trav&#xE9;s de m&#xE9;todos est&#xE1;ticos.</li></ul><img src="images/statics.png" alt="" width="800px" height=""></img></div><div class="step" step="18" data-x="28800" data-y="0"><h1 id="ejemplo-de-uso-static-en-propiedades">Ejemplo de uso static en propiedades</h1><ul><li>Ver <a href="ejemplosClase4/2-ClasesEnPHPstatic.php">fuente</a></li></ul></div><div class="step" step="19" data-x="30400" data-y="0"><h1 id="metodos-abstractos">M&#xE9;todos abstractos</h1><ul><li>Un m&#xE9;todo es  abstracto si s&#xF3;lo declara el prototipo del m&#xE9;todo y no su implementaci&#xF3;n.</li></ul><h1 id="clases-abstractas">Clases Abstractas</h1><ul><li>No tienen instancias.</li><li>Es cualquier clase que contenga aunque sea un m&#xE9;todo abstracto.</li></ul></div><div class="step" step="20" data-x="32000" data-y="0"><h1 id="abstractos-e-implementaciones">Abstractos e implementaciones</h1><img src="images/abstracto-php.png" alt="" width="" height=""></img><ul><li>Ver <a href="ejemplosClase4/3-ClasesEnPHPabstractasc.php">Abstracciones</a></li></ul></div><div class="step" step="21" data-x="33600" data-y="0"><h1 id="interfaces">Interfaces</h1><ul><li>Son estructuras similares a las clases abstractas.</li><li>Pueden contener s&#xF3;lo m&#xE9;todos abstractos.</li><li>Suelen verse como cat&#xE1;logos de m&#xE9;todos a implementar.</li></ul><pre class="highlight code php"><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">unaInterface</span> <span class="p">{</span>
       <span class="k">function</span> <span class="nf">unMetodo</span><span class="p">(</span> <span class="p">);}</span>
<span class="cp">?&gt;</span></pre><ul><li>Equivalente a:</li></ul><pre class="highlight code php"><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">unaInterface</span> <span class="p">{</span>
       <span class="k">public</span> <span class="k">abstract</span> <span class="k">function</span> <span class="nf">unMetodo</span><span class="p">(</span> <span class="p">);}</span>
<span class="cp">?&gt;</span></pre></div><div class="step" step="22" data-x="35200" data-y="0"><h1 id="interfaces-cont">Interfaces (Cont.)</h1><ul><li>Una clase puede implementar una o m&#xE1;s interfaces.</li><li>Debe proveer una implementaci&#xF3;n para todos los m&#xE9;todos definidos en la interface.</li></ul><pre class="highlight code php"><span class="cp">&lt;?php</span>
 <span class="k">class</span> <span class="nc">MiClase</span> <span class="k">extends</span> <span class="nx">ClaseBase</span> <span class="k">implements</span> <span class="nx">unaInterface</span> <span class="p">{</span>
<span class="c1">//...
</span><span class="p">}</span>
<span class="k">class</span> <span class="nc">MiClase</span> <span class="k">implements</span> <span class="nx">unaInterface</span> <span class="p">,</span> <span class="nx">otraInterface</span> <span class="p">{</span> <span class="c1">//...
</span><span class="p">}</span>
<span class="k">class</span> <span class="nc">OtraClase</span> <span class="k">implements</span> <span class="nx">unaInterface</span> <span class="p">{</span>
<span class="c1">//...
</span><span class="p">}</span>
<span class="cp">?&gt;</span></pre></div><div class="step" step="23" data-x="36800" data-y="0"><h1 id="polimorfismo">Polimorfismo</h1><ul><li>Distintos objetos comparten la misma interfaz y en ejecuci&#xF3;n se determina el c&#xF3;digo a ejecutar, dependiendo del contexto. No importa c&#xF3;mo lo implementa cada uno.</li></ul><pre class="highlight code php"><span class="cp">&lt;?php</span>
<span class="nv">$objetos</span><span class="o">=</span><span class="k">array</span><span class="p">(</span><span class="k">new</span> <span class="nx">Clase1</span><span class="p">(),</span> <span class="k">new</span> <span class="nx">Clase2</span><span class="p">(),</span> <span class="k">new</span> <span class="nx">Clase3</span><span class="p">());</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$objetos</span> <span class="k">as</span> <span class="nv">$unObj</span><span class="p">){</span>
   <span class="nv">$unObj</span><span class="o">-&gt;</span><span class="na">metodoComun</span><span class="p">();</span> <span class="c1">//redefinido para cada clase
</span>   <span class="c1">//...
</span><span class="p">}</span>
<span class="cp">?&gt;</span></pre></div><div class="step" step="24" data-x="38400" data-y="0"><h1 id="excepciones">Excepciones</h1><ul><li>Existe una clase <strong>Exception</strong></li><li><dl><dt>Es posible levantar una excepci&#xF3;n expl&#xED;citamente:</dt><dd><ul><li><strong>throw</strong> new Exception( "my message", 44 );</li><li>Finaliza la ejecuci&#xF3;n del m&#xE9;todo y deja disponible el objeto Exception</li></ul></dd></dl></li><li><dl><dt>Por defecto produce un error fatal</dt><dd><ul><li>Para manejar las excepciones implementa un mecanismo <strong>try/catch</strong></li><li>Cualquier c&#xF3;digo que pueda levantar una excepci&#xF3;n debe estar encerrado dentro de una cl&#xE1;usula try</li><li>El bloque catch se utiliza para manejar la excepci&#xF3;n</li></ul></dd></dl></li></ul></div><div class="step" step="25" data-x="40000" data-y="0"><h1 id="id7">Excepciones</h1><pre class="highlight code php"><span class="cp">&lt;?php</span>
<span class="k">try</span> <span class="p">{</span>
<span class="o">--</span> <span class="nx">sentencias</span> <span class="nx">que</span> <span class="nx">pueden</span> <span class="nx">producir</span> <span class="nx">una</span> <span class="nx">excepci</span><span class="err">&#xF3;</span><span class="nx">n</span>        <span class="o">--</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="o">--</span>  <span class="nx">sentencias</span> <span class="nx">para</span> <span class="nx">manejar</span> <span class="nx">la</span> <span class="nx">excepci</span><span class="err">&#xF3;</span><span class="nx">n</span> <span class="o">--</span>
<span class="p">}</span>
<span class="cp">?&gt;</span></pre><p>Ver <a href="ejemplosClase4/4-excepciones.php">excepciones</a> y <a href="ejemplosClase4/5-excepcionesNuevas.php">excepcionesNuevas</a></p></div><div class="step" step="26" data-x="41600" data-y="0"><h1 id="accediendo-a-bases-de-datos">Accediendo a Bases de Datos</h1><img src="images/html-php-sql.png" alt="" width="1000px" height=""></img></div><div class="step" step="27" data-x="43200" data-y="0"><h1 id="lenguaje-sql-structured-query-language">Lenguaje SQL (Structured Query Language)</h1><ul><li>Sentencias insert, update, select, etc....</li><li><dl><dt>Ejemplos:</dt><dd><ul><li>select * from tabla where condici&#xF3;n</li><li>insert into tabla (campos) values (valores)</li><li>update tabla set campo1='valor1' where condici&#xF3;n</li></ul></dd></dl></li></ul></div><div class="step" step="28" data-x="44800" data-y="0"><h1 id="pasos-tipicos">Pasos t&#xED;picos</h1><pre class="highlight code php"><span class="cp">&lt;?php</span>
<span class="c1">//Conectarse a la BBDD
</span><span class="nv">$con</span> <span class="o">=</span> <span class="nx">conectar_a_la_BBDD</span><span class="p">(</span><span class="s2">"mibdd"</span><span class="p">,</span><span class="s2">"usuario"</span><span class="p">,</span> <span class="s2">"clave"</span><span class="p">);</span>

<span class="c1">// Armar la consulta
</span><span class="nv">$consulta</span> <span class="o">=</span> <span class="s2">"SELECT * FROM AlgunaTabla where campo1 ='"</span><span class="o">.</span><span class="nv">$variable</span><span class="o">.</span><span class="s2">"'"</span><span class="p">;</span>

<span class="c1">//Ejecutar la consulta
</span><span class="nv">$resultado</span> <span class="o">=</span> <span class="nx">ejecutar_consulta</span><span class="p">(</span><span class="nv">$consulta</span><span class="p">);</span>

<span class="c1">//Procesar resultados
</span><span class="k">if</span> <span class="p">(</span><span class="nx">tengo_resultados</span><span class="p">(</span><span class="nv">$resultado</span><span class="p">)</span>
   <span class="nv">$campo</span> <span class="o">=</span><span class="nx">extraigo_datos</span><span class="p">(</span><span class="nv">$resultado</span><span class="p">,</span><span class="s2">"nombreCampo"</span><span class="p">);</span>
<span class="cp">?&gt;</span></pre></div><div class="step" step="29" data-x="46400" data-y="0"><h1 id="importante">Importante</h1><h2 id="mysql-motor-de-base-de-datos"><strong>MySQL</strong>: Motor de Base de Datos</h2><h2 id="sql-lenguaje-de-consulta"><strong>SQL</strong>: Lenguaje de Consulta</h2></div><div class="step" step="30" data-x="48000" data-y="0"><img src="images/mysql.jpg" alt="" width="" height=""></img><h1 id="consejos">Consejos</h1><ul><li>Habilitar los logs de la manera m&#xE1;s descriptiva posible</li><li>Instalar alguna aplicaci&#xF3;n que nos permita acceder de manera menos complicada a la base de datos &#x2192; PhpMyAdmin</li></ul></div><div class="step" step="31" data-x="49600" data-y="0"><h1 id="mysql">MySQL</h1><ul><li>El archivo m&#xE1;s importante de MySQL es su configuraci&#xF3;n que la encontramos en /etc/mysql/my.cnf</li><li>Por defecto el log esta deshabilitado por cuestiones de performance.</li><li>Ejemplos de configuraci&#xF3;n avanzados: /usr/share/doc/mysql-server-5.1/examples</li></ul></div><div class="step" step="32" data-x="51200" data-y="0"><h1 id="id9">MySQL</h1><p>Habilitar el Log de todas las transacciones:</p><ul><li>general_log_file        = /var/log/mysql/mysql.log</li><li>general_log             = 1</li></ul><p>Loguear consultas lentas y sin &#xED;ndices:</p><ul><li>log_slow_queries       = /var/log/mysql/mysql-slow.log</li><li>long_query_time = 2</li><li>log-queries-not-using-indexes</li></ul></div><div class="step" step="33" data-x="52800" data-y="0"><h1 id="phpmyadmin">PhpMyAdmin</h1><ul><li>Interfaz de Administraci&#xF3;n de la Base de Datos MySQL</li><li>Podemos exportar e importar a varios formatos</li></ul><img src="images/phpmyadmin.png" alt="" width="1000px" height=""></img><p><a href="http://www.phpmyadmin.net">http://www.phpmyadmin.net</a></p></div><div class="step" step="34" data-x="54400" data-y="0"><h1 id="acceso-a-mysql-con-php">Acceso a MySQL con PHP</h1><ul><li><dl><dt>Tipos de recursos: Hay dos tipos de recursos usados en el m&#xF3;dulo MySQL.</dt><dd><ul><li>El identificador de enlace para una conexi&#xF3;n de base de datos</li><li>Un recurso que almacena el resultado de una consulta.</li></ul></dd></dl></li><li><dl><dt>Algunas funciones....</dt><dd><ul><li>mysql_connect(): Conecta a una base de datos</li><li>mysql_select_db: Permite seleccionar una base de datos</li><li>mysql_query(): Env&#xED;a una sentencia SQL a MySQL</li><li>mysql_fetch_row():  Busca un registro en el resultado de una consulta</li><li>mysql_result(): Devuelve los resultados de una consulta</li></ul></dd></dl></li></ul></div><div class="step" step="35" data-x="56000" data-y="0"><h1 id="acceso-a-bbdd-mysql">Acceso a BBDD &#x2013; MySQL</h1><ul><li>En PHP 5, el soporte para MySQL no se encuentra habilitado por defecto.</li><li>La extensi&#xF3;n mysqli es la recomendad que nos permite acceder a la funcionalidad provista por MySQL 4.1.2 o superior.</li><li>Ver formas de utilizarlo en <a href="http://www.php.net/manual/es/mysqli.construct.php">http://www.php.net/manual/es/mysqli.construct.php</a></li></ul></div><div class="step" step="36" data-x="57600" data-y="0"><h1 id="proceduralmente">Proceduralmente</h1><pre class="highlight code php"><span class="cp">&lt;?php</span>
<span class="c1">//conection:
</span><span class="nv">$link</span> <span class="o">=</span> <span class="nb">mysqli_connect</span><span class="p">(</span><span class="nv">$db_host</span><span class="p">,</span><span class="nv">$db_user</span><span class="p">,</span><span class="nv">$db_pass</span><span class="p">,</span><span class="nv">$db_base</span><span class="p">)</span> <span class="k">or</span>
        <span class="k">die</span><span class="p">(</span><span class="s2">"Error "</span> <span class="o">.</span> <span class="nx">mysqli_error</span><span class="p">(</span><span class="nv">$link</span><span class="p">));</span>
<span class="c1">//consultation:
</span><span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT nombre FROM usuarios"</span> <span class="k">or</span>
         <span class="k">die</span><span class="p">(</span><span class="s2">"Error in the consult.."</span> <span class="o">.</span> <span class="nx">mysqli_error</span><span class="p">(</span><span class="nv">$link</span><span class="p">));</span>
<span class="c1">//execute the query.
</span><span class="nv">$result</span> <span class="o">=</span> <span class="nv">$link</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
<span class="c1">//display information:
</span><span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">echo</span> <span class="nv">$row</span><span class="p">[</span><span class="s2">"nombre"</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"&lt;br&gt;"</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">mysqli_close</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>
<span class="cp">?&gt;</span></pre></div><div class="step" step="37" data-x="59200" data-y="0"><h1 id="acceso-a-la-base-con-mysqli">Acceso a la Base con mysqli</h1><p>Ver <a href="ejemplosClase4/6-accedoabase.php">accediendo</a></p></div><div class="step" step="38" data-x="60800" data-y="0"><h1 id="objetos">Objetos</h1><pre class="highlight code php"><span class="cp">&lt;?php</span>
<span class="c1">//conection:
</span><span class="nv">$con</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mysqli</span><span class="p">(</span><span class="nv">$db_host</span><span class="p">,</span><span class="nv">$db_user</span><span class="p">,</span><span class="nv">$db_pass</span><span class="p">);</span>
<span class="nv">$con</span><span class="o">-&gt;</span><span class="na">select_db</span><span class="p">(</span><span class="nv">$db_base</span><span class="p">);</span>
<span class="c1">//consultation:
</span><span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT nombre FROM usuarios"</span><span class="p">);</span>
<span class="c1">//execute the query.
</span><span class="nv">$result</span> <span class="o">=</span> <span class="nv">$con</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
<span class="c1">//display information:
</span><span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">fetch_row</span><span class="p">())</span> <span class="p">{</span>
  <span class="k">echo</span> <span class="nv">$row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"&lt;br&gt;"</span><span class="p">;</span>
<span class="p">}</span>
<span class="nv">$result</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
<span class="cp">?&gt;</span></pre></div><div class="step" step="39" id="motores-db" data-x="62400" data-y="0"><h1 id="mas-motores">M&#xE1;s Motores</h1><img src="images/sqlserverdb.png" alt="" width="" height="158"></img><img src="images/sqllitedb.png" alt="" width="" height="158"></img><img src="images/oracledb.png" alt="" width="" height="158"></img><table cellpadding="0" cellspacing="0"><tbody><tr><td><p>CUBRID</p></td><td><p>DB++</p></td><td><p>dBase</p></td><td><p>filePro</p></td><td><p>SQLite</p></td></tr><tr><td><p>Paradox</p></td><td><p>FrontBase</p></td><td><p>IBM DB2</p></td><td><p>Informix</p></td><td><p>Sybase</p></td></tr><tr><td><p>Ingres</p></td><td><p>MaxDB</p></td><td><p>MongoDB</p></td><td><p>mSQL</p></td><td><p>PostgreSQL</p></td></tr><tr><td><p>Microsoft SQL Server</p></td><td><p>MySQL</p></td><td><p>Oracle OCI8</p></td><td><p>Ovrimos SQL</p></td><td><p>Firebird/InterBase</p></td></tr></tbody></table><img src="images/informixdb.png" alt="" width="" height="158"></img><img src="images/postgresql.png" alt="" width="" height="158"></img><img src="images/mongodb.png" alt="" width="" height="120"></img></div><div class="step" step="40" data-x="64000" data-y="0"><h1 id="we-have-a-problem">WE HAVE A PROBLEM!!</h1><img src="images/houston.jpg" alt="" width="" height="450px"></img><ul><li>&#xBF;Qu&#xE9; pasa si queremos migrar de motor de BDD?</li><li>&#xBF;Qu&#xE9; pasa si queremos tener m&#xFA;ltiples BDD conectadas?</li></ul></div><div class="step" step="41" data-x="65600" data-y="0"><h1 id="abstrayendonos-otra-opcion-pdo">Abstray&#xE9;ndonos &#x2192; Otra opci&#xF3;n PDO</h1><ul><li>La extensi&#xF3;n Objetos de Datos de PHP (PDO por sus sigl&#xE1;s en ingl&#xE9;s) define un interfaz ligera para poder acceder a bases de datos en PHP.</li><li>Hay que usar un controlador de PDO espec&#xED;fico para cada servidor de base de datos.</li><li>PDO proporciona una capa de abstracci&#xF3;n de acceso a datos, lo que significa que, independientemente de la base de datos que se est&#xE9; utilizando, se usan las mismas funciones para realizar consultas y obtener datos &#x2192; Permitir&#xED;a cambiar de motor de base de datos.</li><li>Ver <a href="ejemplosClase4/8-pdo.php">drivers</a></li></ul></div><div class="step" step="42" data-x="67200" data-y="0"><h1 id="con-pdo">Con PDO</h1><pre class="highlight code php"><span class="cp">&lt;?php</span>
<span class="k">try</span>&#xA0;<span class="p">{</span>
&#xA0;&#xA0;&#xA0;&#xA0;<span class="nv">$gbd</span>&#xA0;<span class="o">=</span>&#xA0;<span class="k">new</span>&#xA0;<span class="nx">PDO</span><span class="p">(</span><span class="s1">'mysql:host=localhost;dbname=test'</span><span class="p">,</span>&#xA0;<span class="nv">$usuario</span><span class="p">,</span>&#xA0;<span class="nv">$pass</span><span class="p">);</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$gbd</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'SELECT&#xA0;*&#xA0;from&#xA0;FOO'</span><span class="p">)</span>&#xA0;<span class="k">as</span>&#xA0;<span class="nv">$fila</span><span class="p">)</span>&#xA0;<span class="p">{</span>
               <span class="nb">print_r</span><span class="p">(</span><span class="nv">$fila</span><span class="p">);}</span>
       <span class="nv">$gbd</span>&#xA0;<span class="o">=</span>&#xA0;<span class="k">null</span><span class="p">;</span>
<span class="p">}</span>&#xA0;<span class="k">catch</span>&#xA0;<span class="p">(</span><span class="nx">PDOException</span>&#xA0;<span class="nv">$e</span><span class="p">)</span>&#xA0;<span class="p">{</span>
   <span class="k">print</span>&#xA0;<span class="s2">"&#xA1;Error!:&#xA0;"</span>&#xA0;<span class="o">.</span>&#xA0;<span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span>&#xA0;<span class="o">.</span>&#xA0;<span class="s2">"&lt;br/&gt;"</span><span class="p">;</span>
   <span class="k">die</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">?&gt;</span></pre></div><div class="step" step="43" data-x="68800" data-y="0"><h1 id="con-pdo-ejemplo-2">Con PDO ejemplo 2</h1><pre class="highlight code php"><span class="cp">&lt;?php</span>
<span class="nv">$status</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">"status"</span><span class="p">];</span>
<span class="k">try</span> <span class="p">{</span>
   <span class="nv">$cn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s2">"mysql:dbname=base;host=localhost"</span><span class="p">,</span><span class="s2">"user"</span><span class="p">,</span><span class="s2">"pass"</span><span class="p">);</span>
   <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$cn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">"SELECT * FROM usuarios WHERE status=?"</span><span class="p">);</span>
   <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$status</span><span class="p">));</span>
   <span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">())</span>
        <span class="p">{</span> <span class="k">echo</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'nombre'</span><span class="p">];</span>
         <span class="p">}</span>
 <span class="p">}</span>
<span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
   <span class="k">echo</span> <span class="s2">"ERROR"</span><span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">?&gt;</span></pre></div><div class="step" step="44" data-x="70400" data-y="0"><h1 id="ver-ejemplo-con-pase-de-parametro">Ver ejemplo con pase de par&#xE1;metro</h1><h2 id="ver"><a href="ejemplosClase4/9-pdo.php?id=1">Ver</a></h2></div><div class="step" step="45" data-x="72000" data-y="0"><h1 id="en-general">En general</h1><ul><li><a href="http://php.net/manual/es/class.pdostatement.php">http://php.net/manual/es/class.pdostatement.php</a></li><li><a href="http://php.net/manual/es/book.mysqli.php">http://php.net/manual/es/book.mysqli.php</a></li></ul></div><div class="step" step="46" data-x="73600" data-y="0"><h1 id="comparando">Comparando</h1><ul><li>A mayor abstracci&#xF3;n menos control .</li><li>Al abstraernos es posible que se compliquen algunas funciones propias del motor que queremos usar.</li><li><dl><dt>&#xBF;La abstracci&#xF3;n es necesaria?</dt><dd><ul><li>Menos control con PDO que con mysqli.</li></ul></dd></dl></li><li>Algunas bases no est&#xE1;n disponibles con PDO y hay que usar si o si el dirver espec&#xED;fico. Ver <a href="http://www.php.net/manual/es/pdo.drivers.php">http://www.php.net/manual/es/pdo.drivers.php</a></li></ul></div><div class="step" step="47" data-x="75200" data-y="0"><h1 id="una-vuelta-de-rosca-mas-orm">Una vuelta de rosca m&#xE1;s-&gt;ORM</h1><img src="images/orm.png" alt="" width="900px" height=""></img></div><div class="step" step="48" data-x="76800" data-y="0"><h1 id="orm-object-relational-mapping">ORM - Object-Relational Mapping</h1><ul><li>Mapeo de Objetos a Base de Datos Relacionales.</li><li>Permite acceder a una base de datos relacional como si fuera orientada a objetos.</li><li>Transforma las llamadas a los objetos en consultas SQL, que permiten independizar el motor de BD utilizado en la aplicaci&#xF3;n.</li><li>De acuerdo a la implementaci&#xF3;n se utiliza una sintaxis diferente.</li></ul></div><div class="step" step="49" data-x="78400" data-y="0"><h1 id="por-que">&#xBF;Por qu&#xE9;?</h1><ul><li><dl><dt>BBDD relacionales</dt><dd><ul><li>Datos escalares: n&#xFA;meros, cadenas de texto,etc&#x2026;</li></ul></dd></dl></li><li><dl><dt>Aplicaciones orientadas a objetos</dt><dd><ul><li>Objetos con propiedades y m&#xE9;todos</li></ul></dd></dl></li><li><dl><dt>&#xBF;Problema?</dt><dd><ul><li>Convertir los objetos en datos escalares para grabar los datos en la Base de Datos y volver a convertirlos en objetos al recuperarlos.</li></ul></dd></dl></li></ul></div><div class="step" step="50" data-x="80000" data-y="0"><h1 id="orm">ORM</h1><ul><li><dl><dt>Ventajas</dt><dd><ul><li>Abstracci&#xF3;n a la BBDD</li><li>Reutilizaci&#xF3;n de c&#xF3;digo</li></ul></dd></dl></li><li><dl><dt>Desventajas</dt><dd><ul><li>Otra capa intermedia</li><li>Otro lenguaje de consulta</li></ul></dd></dl></li><li><dl><dt>Algunos ORMs</dt><dd><ul><li>Propel</li><li>Doctrine</li><li>LinQ</li><li>Active Record</li></ul></dd></dl></li></ul></div><div class="step" step="51" data-x="81600" data-y="0"><h1 id="referencias">Referencias</h1><ul><li>PHP -&gt; <a href="http://php.net">http://php.net</a></li><li>PhpMyAdmin -&gt; <a href="http://www.phpmyadmin.net">http://www.phpmyadmin.net</a></li><li>Lenguaje SQL -&gt; <a href="http://www.w3schools.com/sql/default.asp">http://www.w3schools.com/sql/default.asp</a></li><li>MySQL -&gt; <a href="http://dev.mysql.com/doc/">http://dev.mysql.com/doc/</a></li><li>PDO -&gt;  <a href="http://www.php.net/manual/es/class.pdostatement.php">http://www.php.net/manual/es/class.pdostatement.php</a></li><li>Mysqli -&gt; <a href="http://php.net/manual/es/mysqli.prepare.php">http://php.net/manual/es/mysqli.prepare.php</a></li></ul></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Left, Down, Page Down</th><td>Next slide</td></tr><tr><th>Right, Up, Page Up</th><td>Previous slide</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>